--> ***************** F4 Printer Control ******************* <--          COPYRIGHT 2003 h-peter recktenwald Berlin                                                                                                                                             F4 mit Texten und Programmen darf ohne Zustimmung des Autors nurgemäß der QT-Lizenz benutzt, copiert oder weitergegeben werden; patentrechtliche verwertung behaelt sich der autor selbst vor.                                                                                        h.-peter recktenwald                                               d-12159 berlin                                                   albestr.  21                                                                                            F4 printer control, ex F6 forth 'forth.scr'                     1st   1993 Jul 14  19:41  µ  latest:       Th 2003-08-14                                                   Su 2004-01-17                                                                      -->     ( F6 WORDS' LIBRARY: PRINTER CONTROL FOR F4 )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           1234567890                                            1234567890          1234567890                        1234567890          -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 1 warning !                                                     10 load                                                                                                                     \ cr pad 400 dr? bchan ch-name type ":4: emit cr order vocs cr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  forth definitions decimal    if-found console ;s                                                        \   xlload vdef         vocabulary printing immediate                                   printing definitions                                            \ ' editor v2>pfa is printing   ' printing is editor            ' forth v2>pfa is printing   ' printing is forth                                                                                xlload !hlp   ( for "help" from f4x source )                    xlload? cmc0    xlload? out@    xlload? f"      xlload? stg     xlload? to-stg  xlload? edline  xlload? [e]                                                                                                                                             -->     \ printing   ( -- )                                             \   voc for simultaneous output to the stdout- and prt-channels                                                                                                                                                                                                 forth definitions    xlload? mxy                                                     xlload? cmc0                                                    xlload? path-max                           printing definitions xlload? >col                                                    xlload? >bot                               forth definitions    xlload? palias                                                  xlload? :clists:                           hidden definitions   xlload? h]                                                                                                                                                         -->                                                                                                                                                                                                                                                                                                                                     forth definitions decimal                                                            hlp!       ( this file into "help" chain )                                                                 if-nfound \e         27 constant \e     \ : \e <esc> code       : >< bswap #16 >> ;                                             : >|< 0 #256 u/mod ;                                                                                                                                                                    -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printing definitions decimal                                                                                                    : xp prt chp stdout chp c!! ;                                   : prt-ch prt chan ;                                             : o? stdout ch-cons ;                                                                                                   -->                                                                                                                                                                                                                                                                     \ xp        ( -- )                                              \   exchange rel-chan pointers of <stdout> and <prt>            \ prt-ch    ( -- ch )                                           \   redirected system channel no.                               \ o?        ( -- flg )                                          \   tf if stdout is a console/terminal channel                  printing definitions decimal                                      4   constant tmg      ( : tmg oberer rand                       6   constant bmg      ( : bmg unterer rand                     14   constant lmg      ( : lmg linker rand                     160         =: plw      ( : plw spalten pro zeile                16   constant lsp      ( : lsp links zeilenabstand              12   constant ipg      ( : ipg "/seite                         180   constant lfi      ( : lfi einheit für zeilenvorschub                                                                      ipg lfi lsp */ =: lpg   ( : lpg zeilen pro seite                lpg lpg tmg bmg + -                                                  2constant pgl      ( : pgl lo sing: seitenlänge                                    (       hi sing: zeilenzähler                                                                   -->                                                                                                                                     printing definitions decimal                                                                                                     0 constant pon 1 v, 1 , ( : pon -1 drucken 0 display 1 beides   1    constant dis      ( : dis flag listenausgabe               0    constant pse      ( : pse wartezeit zwischen den seiten    1    constant syn      ( : syn flag zur verwendung mit p-tog                                                                   $0a0d constant <crlf>   ( : <crlf> neue zeile                   #12   constant <ff>     ( : <ff>   neue seite / bild löschen    #15   constant <si>     ( : <si>   doppelte druckdichte         #127  constant <del>    ( : <del>  voriges zeichen löschen                                                                                                                              -->                                                                                                                                                                                                     printing definitions decimal                                                                                                    ' n.i.  defer p-on      ( : p-on    drucker ein                 ' n.i.  defer p-off     ( : p-off   drucker aus                 ' noop  defer p-start   ( : p-start initiate the printer                                                                        warning @ warning off forth definitions                         ' noop if-found home drop ' home    \ cursor to top left        ' noop if-found cls drop ' cls      \ home & clear screen               defer cls                                                       defer home                                              warning !                                                                                                               -->                                                                                                                                                                                                     printing definitions decimal                                                                                                    if-nfound #tab (up) @ ucons #tab  4 (up) +!                     4 to #tab                                                                                                                       path-max ddup                                                   s" /dev/tty7"  dup stg pts ( : pts probehalber                  s" ./f4-print" rot stg pfi ( : pfi file                         s" /dev/par0"  rot stg pdv ( : pdv wirklicher drucker           pfi scount     rot stg drk ( : drk mit dem zu benutzenden namen 0.              4K stg opb ( : opb for use by o-prt (only!)                                                             -->     \ #tab  ( -- n )                                                \   ucons, tabulator-schrittweite                               \ drk       ( -- a )                                            \   string vari, 'printer' file-name, redefine w. {to-stg}      printing definitions decimal ( character translation table )                                                                                                                                    4 (up) dup @ user (tt) +!        \ link für zeichensätze        4 (up) dup @ user (tra) +!       \ zeichenumsetzung in-/aktiv                                                                   ' noop defer (tr)               \ chars translation routine                                                                                                                             -->                                                                                                                                                                                                     \ tra   ( n -- )                                                \   1  aktuelle umsetzungstabelle aktivieren                    \   0  umsetzung abschalten                                     \   -1 vorgabe-tabelle verwenden                                printing definitions decimal                                                                                                    0.              1K stg vtb ( : vtb for numeric vt-ctrl strings                                                                         vtb 4K +                                                 : <#v [ dup ] literal hld ! ;                                   : v#> hld@ [ dup ] literal over- ;  drop                                                                                                                                                -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                     forth definitions decimal                                                                                                       : p-set printing ' pon >body 4+ ! ; \ print-mode einstellen     : p-dis 0 p-set ;               \ nur {stdout}                  : p-sim 1 p-set ;               \ {prt}-kanal, {stdout} simultan: p-prt -1 p-set ;              \ nur {prt}-kanal                                                                               : p-tog printing syn pon        \ umschalten simultan<->stdout    if 1 and p-off else minus p-on endif is syn ;                                                                                 : ?pset printing                                                  p-off dup is pon -dup 0= -exit p-set p-on ; ( flg --          : ?p-off printing pon p-off ;   \ -- flg ( temp. nicht drucken  : ?p-on 0= -exit p-on ;         \ flg -- ( temp. zurück                                                                 -->                                                                     ( printer syscalls ========================== : sbyte : sstrg ) printing definitions decimal                                                                                                    : sbyte ( n ch -- )                                               >r bcount sp@ 4- r ch-id sp@ sys write                          r> cdt <rnum> ! 5 ndrop ;                                                                                                     : sstrg ( a u ch -- )                                             >r swap r ch-id sp@ sys write r> cdt <rnum> ! 4drop ;                                                                 -->                                                                     \ sbyte ( n ch -- )                             (s) forth       \   send multi-byte cell n, l.s. non-zero bytes to channel ch   \   single <nul> byte sent if n = 0                             \ sstrg ( a u ch -- )                           (s) forth       \   send u bytes of data at address a to channel ch;            ( ================================== : semit : stype : setype ) printing definitions decimal                                                                                                    : stype over 0=/= over 1- 0< 0= and             ( a u -- )        if stdout chan sstrg exit endif 2drop ;                                                                                       : setype over 0=/= over 1- 0< 0= and            ( a u -- )        if >rr >loc r l0 e\stg stdout chan sstrg r> loc> exit endif     2drop ;                                                                                                               -->                                                                                                                                                                                                     \ stype ( a u -- )                              forth           \ etype ( a u -- )                              forth           \   expand escapes('etype'); send string(a,u) to stdout         ( : stab : sbs : sspace : semit ) printing definitions decimal                                                                  : semit stdout chan sbyte ;                     ( n -- )                                                                        : sbs 8 semit ;                                                 : sspace bl semit ;                                             : stab 9 semit ;                                                                                                                                                                        -->                                                                                                                                                                                                     \ sbs   ( -- )                                                  \   output pos one column back                                  \ semit ( n -- )                                forth           \   multi-byte cell n l.s. non-zero bytes or, <nul> to stdout   ( ==== : bspaces : mcr : sspaces ) printing definitions decimal                                                                 : bspaces 0max -dup 0= -exit                    ( n -- )          >rr >loc l0 r 2dup 8 fill stdout chan sstrg r> loc> ;                                                                         : sspaces 0max -dup 0= -exit                    ( n -- )          >rr >loc l0 r 2dup bl fill stdout chan sstrg r> loc> ;                                                                        : mcr 0max -dup 0= -exit 0 do cr loop ;     \ drucker-mode {cls}                                                        -->     \ bspaces   ( n -- )                                            \   #n back-spaces to rstdout                                   \ sspaces   ( n -- )                                            \   #n blanks to rstdout                                        \ mcr      ( +n -- )                                            \   execute no. n {cr}s, noop if n \< 0.                        printing definitions decimal ( character translation table )                                                                    : tratab <builds                                                  vp 4 align vp - vallot vp dup , 1K vallot >v                    256. do i 8 << $ff or swap !+ loop (tt) @ over ! v> (tt) !      does> >body swap $ff and 4* + @ dup c->s 1+                     0= over 0= or if 8 >> bcount minus exit endif scount ;                                                                                                                                -->     :AENDERN: -----------------.                                                               v                                    \ tratab    ccc( -- ) ( X: c1 -- a u | char -u | .x. 0 )        \   initiate a character translation table for {semit}, {stype}.\   char item max 3 m.s. bytes, marked by ls-byte = $ff,        \   string address at psitions where ls-byte =/= $ff.           \   ascii <nul> not translatable.                               printing definitions decimal ( character translation table )                                                                      tratab tra1                                                                                                           -->     0) linkfeld mit beginn in uvari {(tt)} -neu-                    1) zeichenweise als byte-index char<->char                      2) posten auf byte = <nul> in besonderer tabelle aus 4th-strings    [ char# ][ countb ][ string ][0]  [char#]... ...[0][0]ende  3) kennung in form des vt-auswahlbefehls, zeichensatz und g0/g1 4) oder auswahl durch index in linkliste und wort {tratab}         oder durch besonderen namen je tra-tabelle  <== !                                                                    -->       vp 4 align vp - vallot vp dup , 1K vallot >v                    256. do i 8 << $ff or swap !+ loop (tt) @ over ! v> (tt) !      does> stdout chan >r >body swap $ff and 4* + @ dup c->s 1+      0= over 0= or if 8 >> r> sbyte exit endif scount r> sstrg ;   ( == cursor == : cure : curd : clsc : cup : cdn : cur+ : cur-   hidden definitions                                                                                                              : (svt) <builds name count                      ( ccc vvv, -- )   dup 4+ >rr >loc l0 e\stg here over 4+ allot place r> loc>       does> count stype ;                                                                                                           warning @ warning off vt definitions printing                   (svt) cure  \e[?25h     (svt) curd \e[?25l  \ en/disable cursor (svt) cdn   \e[B        (svt) cup  \e[A     \ cursor down, up   (svt) cur+  \e[C        (svt) cur- \e[D     \ cursor right, left(svt) clsc  \e[2J       (svt) hom  \e[H                                   warning ! definitions                                 : [0r 0. [e] (col) 2! out off ;         \ cursor 'home',top left                                                        -->                                                                     printing definitions                                                                                                            : <hom> [0r o? if vt hom exit endif <ff> semit ; ' <hom> is home: <cls> home o? 0= -exit vt clsc ;               ' <cls> is cls                                                                 : [tab] ( n -- ( set display column, dft for {>tab}           )   xy drop >rr - 1 max out@ max-xy drop                            r> to out ddup +to col +to out sspaces ;                                                                              -->                                                                     \ home  ( -- )                                  forth           \   vt display: cursor to top left; other: emit form feed code  \ cls   ( -- )                                  forth           \   vt display: cursor home & clear screen; other: emit <ff>    \ >tab  ( n -- )                                (d) printing    \   display posn to column #n; adjust out, col, row accordingly printing definitions decimal                                                                                                    ' [tab] defer >tab      ( : >tab    spalte#/textende aufsuchen                                                                  ' home  defer (ptop)    ( : (ptop)  \ cursor nach oben links    ' cls   defer (ppge)    ( : (ppge)  \ bild löschen, curs. bleibt                                                                                                                        -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printing definitions                                                                                                            : pchn?  \  opb 4K prt-ch ch-name 0 opb sp@ sys access           \  >r 5 ndrop r> 0= -dup -exit )                                 prt-ch ch-opn 0dup 0= -exit 0 prt-ch fpose 0< 0= ;                                                                            : oprt? pon drk w@ 0> and ;         ( -- flg )                                                                                  : popn? ( -- flg ( tf: kanal existiert, file 'append', ggf neu)   drk w/o app     prt-ch open 1- 0< 0= -dup -exit                 drk w/o app cre prt-ch open 1- 0< 0= ;                                                                                -->     \ pchn? ( -- flg )                                              \   tf: irgendein prt-kanal existiert, file-pointer ggf auf eof \ oprt? ( -- flg )                                              \   tf: printer freigegeben, kanal hat einen namen              printing definitions decimal                                                                                                    : o-prt pchn? -dup -exit oprt? 0dup 0= -exit                      popn? if pchn? -dup -exit endif                                 stdout chan >r " /dev/tty" w/r new-chan open >rr stdout chp c!  enter begin ?p-off >r                                            drk scount ptype sspace message s"  Stop[] Retry:\a\e[0K"       setype drk 1K edline r> ?pset                                  entry popn? drk w@ 0= or until                                  r> close drop r> stdout chp c! pchn? ;                                                                                -->     \ o-prt ( -- flg )                                              \   prt-kanal mit namen aus string-vari {drk} aufmachen.        \   tf, wenn verwendbarer drucker-kanal existiert               \   ff, wenn name gelöscht/unbrauchbar oder drucker gesperrt    \       oder kanal offen aber unbrauchbar                       --> ====================== : ctrls : ======================= <--                                                                 127 del left           1   -/-             2   -/-                3   -/-              4   -/-             5   -/-                6 curs right         7 acoustic signal   8 cursor left          9 tabulator step    10 new line         11 cursor up           12 form feed         13 carriage return  14 enable cursor       15 disable cursor    16   -/-            17   -/-               18 curs to col#      19   -/-            20   -/-               21   -/-             22   -/-            23 cursor left         24 cursor down       25   -/-            26   -/-               27   -/-             28   -/-            29 ret sizes & cursor  30 curs home         31 curs to col#,row#                                                                                          -/- emit the rsp. code w.o. special procedure                       cons pon: -1 drucken, 0 display, 1 beides              -->         \ ctrl code case:-list pattern                                                                                      case: [actl] [del] [soh] [stx] [etx] [eot] [enq] [ack] [bel]                 [bs]  [ht]  [lf]  [vt]  [ff]  [cr]  [so]  [si]                  [dle] [dc1] [dc2] [dc3] [dc4] [nak] [syn] [etb]                 [can] [em]  [sub] [esc] [fs]  [gs]  [rs]  [us] ;                                                                                                                                                                                                                                                                   \ [cctl]    ( .x. -- .n. n )                                    \   console/terminal channel ctrl code operation                \ [fctl]    ( .x. -- .n. n )                                    \   file channel ctrl code operation                            \ [vctl]    ( -- )                                              \   ctrl words' sys-vari opr's                                  printing definitions decimal        \ ctrl code, display output                                                                 : [fe] 0 #case semit ;                                          ' 0 palias [ct1]                    \ : [ct1] noop                                                                              : [del] 0 sbs sspace sbs ;          \ 127 del left              : [ack] #0 $435b1b semit ;          \   6 curs right            : [bel] #0 7 semit ;                \   7 bell                  : [bs] 0 sbs ;                      \   8 curs left             : [ht] 0 stab ;                     \   9 curs to next tab      : [lf] 0 <crlf> semit ;             \  10 new line              : [vt]                              \ curs up, scroll dn          #0 [ "M 8 << \e or ] literal semit ;                          : [ff] 0 cls ;                      \ 12 clr screen & cur home                                                          -->                                                                     printing definitions decimal        \ ctrl code, display output                                                                 : [cr] 13 semit 0 ;                 \ 13 carriage return        : [so] cure 0 ;                     \ 14 enable cursor          : [si] curd 0 ;                     \ 15 disable cursor display : [dc2] 1+ 0 base@ >r decimal       \ 18 curs to col#             <#v "G hold #s "[ hold \e hold v#> stype r> base ! 0 ;        : [etb] sbs 0 ;                     \ 23 cursor left            : [can]                             \ 24 curs down, scroll up     #0 [ "D 8 << \e or ] literal semit ;                          : [gs] [ (maxy) @ , (xy) @ , ] 4 ;  \ 29 ret sizes & curs posn  : [hom] 0 0. [ (atxy) @ , ] ;       \ 30 curs top left          : [us]                ( x y - x y ) \ 31 curs to col, row         2dup [ (atxy) @ , ] 0 ;                                                                                               -->                                                                     printing definitions decimal        \ ctrl code, display output                                                                 case: [cctl] [del] [fe]  [fe]  [fe]  [fe]  [fe]  [ack] [bel]                 [bs]  [ht]  [lf]  [vt]  [ff]  [cr]  [so]  [si]                  [fe]  [fe]  [dc2] [fe]  [fe]  [fe]  [fe]  [fe]                  [can] [fe]  [fe]  [fe]  [fe]  [gs]  [hom] [us]                  [fe] ;                                                                                                                                                                     -->                                                                                                                                                                                                     \ [cctl]    ( .x. -- .n. n )                                    \   console/terminal channel ctrl code operation                \   receives args & returns args and args count,                \   as specified for the rsp. control-code operation            printing definitions decimal        \ ctrl code file output                                                                     : [fde] 0 sbs ;                     \ 127, 8 del left, backspace: [flf] 0 <crlf> semit ;            \ 10 new line               : [fd2]                             \ 18 curs to col#             col - dup 0= + dup 0< if minus bspaces exit endif sspaces 0 ;                                                                                                                         -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printing definitions decimal        \ ctrl code file output                                                                     : [fca]                             \ 24 line feed, w.o. <cr>     0 <crlf> semit col sspaces ;                                  : [fgs] plw lpg col row 4 ;         \ 29 ret sizes & curs posn  : [fhm] 0 <ff> semit ;              \ 30 cursor to top left posn: [fus]                             \ 31 curs to col, row         2dup row - 0max 0 do <crlf> semit loop sspaces 0 ;                                                                    -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printing definitions decimal        \ ctrl code file output                                                                     case: [fctl] [fde] [fe]  [fe]  [fe]  [fe]  [fe]  [fe]  [fe]                  [fde] [fe]  [flf] [fe]  [fe]  [cr]  [fe]  [fe]                  [fe]  [fe]  [fd2] [fe]  [fe]  [fe]  [fe]  [etb]                 [fca] [fe]  [fe]  [fe]  [fe]  [fgs] [fhm] [fus]                 [fe] ;                                                                                                                                                                     -->                                                                                                                                                                                                                                                                                                                                     \ [fctl]    ( .x. -- .n. n )                                    \   file channel ctrl code operation                            printing definitions decimal            \ [vctl] sysvari ctrls                                                                  : [ct1 -1 out +! ;                                              : row+- row 0max [e] (row) ! ;                                  : out+- out@ 0max out !                                           col 0< if editor (col) off -1 (row) +! endif row+- ;          : max-wh max-xy -dup -exit 2drop plw lpg ;                      : max-w max-wh drop ;                                           : max-h max-wh sdrop ;                                                                                                          : [+c 1 dup [e] (col) +! out +! ;       \ next column           : [+r 1 [e] (row) +! [ct1 ;             \ next row              : [-c -1 [e] (col) +! -2 out +! out+- ; \ previous, +ve column  : [-r -1 [e] (row) +! row+- [ct1 ;      \ previous, +ve row                                                             -->                                                                     printing definitions decimal            \ [vctl] sysvari ctrls                                                                  : [0c                                   \ <cr> 1st column         out@ 1- 0max max-w /mod [e] (row) +! 0 [e] (col) ! out -! ;                                                                   : [ht               ( -- )                                        #tab out@ 1- over mod - out +! ;      \ 9 curs to next tab    : [lf editor [0c [+r pon 0= -exit       \ 10 new line             pgl 1- to pgl (bot) 0max 1- to (bot) ;                        : [vt max-w out -! [-r ;                \ 11 curs up, scroll dn : [dc2              ( n -- )            \ 18 curs to col#         dup out@ 1- max-w / [e] (row) +! dup [e] (col) ! out ! ;      : [us [e] (col) 2! [ct1 ;   ( x y -- )  \ 31 curs to col, row                                                                                                                           -->                                                                     printing definitions decimal            \ [vctl] sysvari ctrls                                                                  case: [vctl] [-c   [ct1  [ct1  [ct1  [ct1  [ct1  [+c   [ct1                  [-c   [ht   [lf   [vt   [0r   [0c   [ct1  [ct1                  [ct1  [ct1  [dc2  [ct1  [ct1  [ct1  [ct1  [-c                   [+r   [ct1  [ct1  [ct1  [ct1  [ct1  [0r   [us                   noop ;                                                                                                     -->                                                                                                                                                                                                                                                                                                                                                                                                     \ [vctl]    ( .x. ccode -- )                                    \   ctrl words' sys-vari opr's                                  printing definitions decimal                                                                                                    : pprt  r+ pon >r p-prt xp execute xp r> ?pset ;                : pdis  r+ pon >r p-off execute r> ?pset ;                      : pwork r+                                                        stdout chp dup 1 m>r >r prt stdout chp c! execute r> 1 r>m ;                                                                  : p'prt  compile pprt  cmc0 ;   immediate   \ tmp printing only : p'dis  compile pdis  cmc0 ;   immediate   \ tmp display only  : p'work compile pwork cmc0 ;   immediate   \ tmp stdout := prt                                                                                                                         -->                                                                                                                                     \ [pctl]    ( ch -- .xx. )                                      \   for {ctrl}, handling of terminal and file channels          printing definitions decimal                                                                                                    : [pctl] o? if [cctl] else [fctl] endif ;                                                                                                                                               -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( {ctrl} word for 'bh' program compat )                                                                                         : ctrl dup range: #32 #127 #128 ; dup 1 and 2* -dup -exit         2- 0= + 31 and >r pon 0< 0= if r [pctl] endif       ( flag! )   o-prt if r pon >r -1 to pon p'work [pctl] r> to pon endif       r> [vctl] ;                                                                                                                                                                           -->                                                                     \ ctrl  ( .x. -- .nn. n )                                       \   ctrl code op, code 127 at #0; ret n = no of cells left @tos;\   code 18, [dc2], receives column no,                         \   code 29, [gs], returns window sizes and cursor co-ordinates \   code 31, [us], receives column and row no,                  \   other ctrls neither receive nor return any args but the flag\   re { : ctrls ; help ctrls forget ctrls }                    printing definitions decimal                                                                                                    : fe] semit 0 ;                                                 : bel] [bel] 1or ;                                              : bs]  [bs]  1or ;                                              : ht]  [ht]  1or ;                                              : lf]  [lf]  1or ;               : flf] [flf] 1or ;             : vt]  [vt]  1or ;                                              : ff]  [ff]  1or ;                                              : cr]  [cr]  1or ;                                              : del] [del] 1or ;               : fde] 1 sbs ;                                                                                                                                         -->                                                                                                                                                                                                     printing definitions decimal                                                                                                    \ standard ctrl-s by 'emit':                                    \   del:127 bel:7 bs:8 tab:9 cr+lf:10 vt=lf:11 ff:12 cr:13                                                                      associative: <pc>   7   8   9   10  11  12  13  127 ;                  case: <pt> bel] bs] ht]  lf] vt] ff] cr] del] fe] ;             case: <pf>  fe] fe] fe] flf] fe] fe] cr] fde] fe] ;                                                                      : <pctl>     ( c -- )                                             dup <pc> o? if <pt> else <pf> endif ndrop ;                                                                           -->                                                                                                                                                                                                                                                                     printing definitions                                                                                                            : pxy #29 ctrl pon 0< 0=                                          if dup 1+ nswap endif ndrop drop 2sdrop ;                                                                                     : patxy pon 0< 0= if #31 p'dis [pctl] endif                       o-prt if #31 p'prt [pctl] endif [vctl] ;                                                                                                                                              -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printing definitions decimal                                                                                                    : [pemit] bcount out +! >r                                        pon 0< 0= if r p'dis <pctl> endif                               o-prt if r p'prt <pctl> endif r> [vctl] ;                                                                                     : [ptype] forth  ( a u -- )                                       dup out +! pon 0< 0= if 2dup [ (type) @ , ] endif               o-prt if 2dup p'prt stype endif 2drop ;                                                                               -->                                                                                                                                                                                                                                                                                                                                                                                                     forth definitions                                                                                                               : p-pge pon 0= -exit p'prt (ppge) ;                             : p-top pon 0= -exit p'prt (ptop) ;                                                                                                                                                     -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     forth definitions                                                                                                               : bot? (bot) 0> 0= dup          \ -- f (fenster voll: pause+tf    if pse 0> dis and                                                if 0 max-xy sdrop 2- at-xy bel                                   pse (ti) dup @ >r ! key r> (ti) ! drop                         else drop 0. is (bot) endif                                    endif pon 0= -exit                                              pgl sdrop 0> -exit p-pge ;        ' bot? here 2constant dbot                                                                                                                          -->                                                                                                                                                                                                                                                                                                                                     printing definitions                                                                                                            : !cs dup v, 1- -1 swap do forth i roll cv, -1 +loop ;                                                                          : cs-seq <builds vp , !cs does>                                   pon if o-prt if >body @+ prt-ch sstrg endif 0 endif drop ;                                                                    : cs2seq <builds vp , here >r 0 , !cs vp r> ! !cs                 does> swap if 4+ endif                                          pon if o-prt if >body @+ prt-ch sstrg endif 0 endif drop ;                                                            -->                                                                     \ cs-seq    ( ccc, .x. n -- ) ( X: -- )                         \   store sequence of bytes which word ccc will send to stdout  \ cs2seq    ( ccc, .x. n .y. m -- ) ( X: f -- )                 \   twin {cs-seq} sequences, seq (x,n) selected if f =/= 0      ( : lc24 steuersequenz definieren ) printing definitions         \ initialisierung                                                                                                               depth fld !                    \  ,-<- pg im citizen handbuch        27 "~ 5 0                 \ 220 \ 'epson' emulation             27 "t 1                   \ 172 \ ibm zeichensatz #2            27 "6                     \ 170 \ 256 chars                     27 "~ "4 "1               \ 220 \ null mit strich               27 "C 0 ipg               \ 175 \ ipg seitenlänge in zoll       \e "g <si>                \ 165 \ 15 cpi, komprimiert           27 "O                     \ 176 \ ohne perforationssprung       27 "l lmg                 \ 177 \ linker rand              depth fld @ -   cs-seq lc24    \ : lc24 : 24-pin matrix                                                                -->                                                                                                                                     printing definitions decimal                                                                                                    depth fld !                     \ nur in NEC drucker-modus          28 "R <ff> 28 "F            \ 215 \ papiervorschubrichtung  depth fld@ -    cs-seq pt24     \ : pt24 eine seite zurück                                                                            27 "2   2 cs-seq 1/6"     \ : 1/6" standard linefeed                                                                          27 "3 lsp 3 cs-seq lsp/lfi" \  zeilenvorschub (16/180")                                                                           27 "@   2 cs-seq I10      \ : I10 reset                                                                           -->                                                                                                                                                                                                                                                                     printing definitions decimal                                                                                                    depth fld !                     \ undokumentierte lc240-codes      ( 27 26 "0 0  27 26 "1 6 55 65 128 48 244 226 )  27 ( 26) "@ depth fld@ -    cs-seq i24      \ : i24 init eds & reset  -?-                                                                   27 "U 1 3 27 "U 0 3 cs2seq unidir \ : unidir                                                                                    27 "x 1 3 27 "x 0 3 cs2seq nlq  \ : nlq                                                                                 -->                                                                                                                                     \ unidir    ( flg -- )                                          \   nur in einer richtung drucken ein(tf) oder aus(ff)          \ nlq       ( flg -- )                                          \   hohe dichte ein(tf) oder aus(ff)                            printing definitions                                                                                                    -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printing definitions decimal                                                                                                    depth fld !                                                         27 "S "1 depth fld @ -      cs-seq (sb) \ : (sb) subscript  depth fld !                                                         27 "S "1 depth fld @ -      cs-seq (sp) \ : (sp) superscript' (sb) defer spsc                           \ : spsc                                                                            depth fld !                                                         27 "T    depth fld @ -      cs-seq snsc \ : snsc neither                                                                    : p-nsub snsc 1/6" ;            \ inhibit sub/superscr          : p-sub  spsc lsp/lfi" ;        \ set & enable, toggle                                                                  -->                                                                                                                                     ( printer defn, 24-pin epson, matrix ) printing definitions                                                                     ' lc24 defer pt-s   ( : pt-s schrift-einstellungen            ) ' i10  defer pt-i   ( : pt-i einrichtung & reset              ) ' noop defer pt-p   ( : pt-p drucker auswaehlen               )                                                                 ' pt24 is (ptop)                                                                                                                                                                        -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ( simultan drucken ) printing definitions decimal                                                                               : (ps) pt-s                           \ toggle sub-/super-script  ' (sb) dup cfa ' spsc >body @ = if drop ' (sp) endif is spsc ;                                                                : (pon)      ' pon >body 4+ @ is pon  \ print-modus einstellen    ' patxy   is at-xy ' pxy     is xy  ' @max-xy is max-xy         ' [ptype] is type  ' [pemit] is emit  !max-xy 2drop ;                                                                         : (poff) 0 to pon                     \ nur bildschirm            is< at-xy is< xy   is< max-xy                                   is< type  is< emit ( prt-ch close drop ) ;                                                                            -->                                                                                                                                                                                                     ( simultan drucken ) printing definitions decimal                                                                               ' (pon)  dup is p-on    ' p-on    4+ !  \ initial setting, only ' (poff) dup is p-off   ' p-off   4+ !  \ r/o in save'-d binary ' (ps)   dup is p-start ' p-start 4+ !                                                                                          : prt-ini pt-i is< pt-i ;                                                                                                       : 24pin [ last @ pfa ] literal is pt-p                            ' lc24 is pt-s ' pt24 is (ptop) ' i24 is pt-i ;                                                                                                                                       -->                                                                                                                                                                                                                                                                     ( simultan drucken ) forth definitions                                                                                          : p>file  pfi count to-stg drk ;                                : p>dev   pdv count to-stg drk ;                                if-found pts : p>test  pts count to-stg drk ;                                                                                   : printer p-sim p-on 0 is (ok)                                    pgl drop dup is pgl prt-ini p-sub pt-p p-start ;                                                                              : console                                                         p-off p-dis [ ' (ok) is@ c>pfa sdrop ] literal is (ok)          prt-ch close drop ;                                                                                                                                                                   -->                                                                                                                                     ( simultan drucken ) forth definitions                                                                                          : [pedit] console [ editor ' edit is@ sdrop , ] ;               ' [pedit] is edit                                                                                                                                    if-nfound ed 2 +continue                   ' ed cfa @ editor ' edit cfa @ - if-true 1 +continue            : [ped] console [ ' ed is@ sdrop , ] ; ' [ped] is ed                                                                                                                                    -->                                                                                                                                                                                                     \ [pedit]   ( -- )                                              \ [ped]     ( -- )                                              \   prevent editting while printer output enabled               forth definitions decimal                                                                                                       : "breite                       ( breite in chars ausmessen   )   o? 0= if [ "l 8 << \e or ] literal emit 0 emit endif            cr plw 0 do i #10 mod h>a emit loop                             cr plw 0 do                                                      i 10 mod 0= if i 10 / 10 mod h>a emit 9 spaces endif           loop cr lmg 2- spaces "|> emit cr                               o? -exit [ lmg 8 << "l or 8 << \e or ] literal emit             ."  linker rand: lmg=" lmg . ;                                                                                                                                                                                                                                \  cr .( f4p : 'printing' voc loaded ) cr                                                                                                                                                       ;s \ {printing} words:                                                                                                          \ printer   ( -- )                                              \   enters simultaneous 2nd-ary output mode, where any output to\   stdout will also be sent to the relchan {prt} (5) which is  \   opened as required, from string {drk} in w/o+append mode.   \   {drk} can be set to pre-defined names w. {p>dev}, {p>file}. \   re {pon}, {p-set} which determine the output mode.          \   redirects several i/o words, re {(pon)}, default {p>file},  \   sends an initiation sequence of (ascii-)codes, re {pt-i}.                                                                   \ console   ( -- )                                              \   revert from 2nd-ary output mode, close {prt} channel.       \   reset redirected words to their default definition.                                                                                                                                         ;s                                                                                                                               A B C D E F G H  065-072   I J K L M N O P  073-080             Q R S T U V W X  081-088   Y Z [ \ ] ^ _ `  089-096             a b c d e f g h  097-104   i j k l m n o p  105-112             q r s t u v w x  113-120   y z { | } ~     121-128                      129-136            137-144                      145-152             153-160             ¡ ¢ £ ¤ ¥ ¦ § ¨  161-168   © ª « ¬ ­ ® ¯ °  169-176             ± ² ³ ´ µ ¶ · ¸  177-184   ¹ º » ¼ ½ ¾ ¿ À  185-192             Á Â Ã Ä Å Æ Ç È  193-200   É Ê Ë Ì Í Î Ï Ð  201-208             Ñ Ò Ó Ô Õ Ö × Ø  209-216   Ù Ú Û Ü Ý Þ ß à  217-224             á â ã ä å æ ç è  225-232   é ê ë ì í î ï ð  233-240             ñ ò ó ô õ ö ÷ ø  241-248   ù ú û ü ý þ ÿ    249-255                                                                                                                                            ;s                              (gb2312)                            ^1234567890ß'#  ä1 ä2 ä3 ä4 ä5 ä6 ä7 ä8 ä9 ä0 äß ä' ä#          qwertzuiopü+     äq äw äe är ät äz äu äi äo äp äü ä+            asdfghjklöä       äa äs äd äf äg äh äj äk äl äl ää              <yxcvbnm,.-      ä< äy äx äc äv äb än äm ä, ä. ä-                                  (ae)+key  --^                                °!"§$%&/()=?`'  Ä1 Ä2 Ä3 Ä4 Ä5 Ä6 Ä7 Ä8 Ä9 Ä0 Äß Ä' Ä#          QWERTZUIOPÜ*     ÄQ ÄW ÄE ÄR ÄT ÄZ ÄU ÄI ÄO ÄP ÄÜ Ä+            ASDFGHJKLÖÄ       ÄA ÄS ÄD ÄF ÄG ÄH ÄJ ÄK ÄL ÄÖ ÄÄ              >YXCVBNM;:_      Ä< ÄY ÄX ÄC ÄV ÄB ÄN ÄM Ä, Ä. Ä-                              (AE)+key  --^                                      ² ³   {[]}\  (oe)+key  --.                                    @wertzuiop ~    ö1 ö2 ö3 ö4 ö5 ö6 ö7 ö8 ö9 ö0 öß ö' ö#          asdfghjkl        öq öw öe ör öt öz öu öi öo öp öü ö+            |yxcvbnµ          öa ös öd öf ög öh öj ök öl öö öä                                  ö< öy öx öc öv öb ön öm ö, ö. ö-        
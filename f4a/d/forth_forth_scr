                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **********************  fig-FORTH  MODEL  **********************                                                                                     Through the courtesy of                                                                                                          FORTH INTEREST GROUP                                               P. O. BOX 1105                                              SAN CARLOS, CA. 94070                                                                                                                                                                                 RELEASE 1                                                 WITH COMPILER SECURITY                                                  AND                                                     VARIABLE LENGTH NAMES                                                                                                                                                             Further distribution must include the above notice.      (  ERROR MESSAGES  )                                            EMPTY STACK                                                     DICTIONARY FULL                                                 HAS INCORRECT ADDRESS MODE                                      ISN'T UNIQUE                                                                                                                    DISC RANGE ?                                                    FULL STACK                                                      DISC ERROR !                                                                                                                                                                                                                                                                                                                                                                                                                                                    FORTH INTEREST GROUP                                 MAY 1, 1979(  ERROR MESSAGES  )                                            COMPILATION ONLY, USE IN DEFINITION                             EXECUTION ONLY                                                  CONDITIONALS NOT PAIRED                                         DEFINITION NOT FINISHED                                         IN PROTECTED DICTIONARY                                         USE ONLY WHEN LOADING                                           OFF CURRENT EDITING SCREEN                                      DECLARE VOCABULARY                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (  text,  line                                    WFR-79may01 ) forth definitions   hex                                         : text                        ( accept following text to pad *)    here  c/l  1+  blanks  word  here  pad  c/l  1+  cmove  ;                                                                    : line          ( relative to scr. leave address of line *)           dup  fff0  and  17  ?error   ( keep on this screen )            scr  @  (line)  drop  ;                                   -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (  line editor                                   WFR-79may03 )  vocabulary editor immediate  hex                                : where                  ( print screen # and image of error *)     dup  b/scr  /  dup  scr  !  ." scr # "  decimal  .              swap  c/l  /mod  c/l  *  rot  block  +  cr  c/l  type           cr  here  c@  -  spaces  5e emit  [compile] editor  quit  ;                                                                  editor definitions                                             : #locate                   ( levae cursor offset-2, line-1 *)            r#  @  c/l  /mod  ;                                   : #lead                  ( line address-2, offset-1 to cursor *)           #locate  line  swap  ;                               : #lag           ( cursor address-2, count-1 after cursor *)           #lead  dup  >r  +  c/l  r>  -  ;                         : -move     ( move in block buffer addr from-2,  line to-1 *)            line  c/l  cmove  update  ;   -->                      (  line editting commands                       WFR-79may03 )   : h                            ( hold numbered line at pad *)         line  pad  1+  c/l  dup  pad  c!  cmove  ;                : e                             ( erase line-1 with blanks *)         line  c/l  blanks  update  ;                                                                                                                                                              : s                            ( spread making line # blank *)        dup  1  -  ( limit )  0e ( first to move )                      do  i  line  i  1+  -move  -1  +loop  e  ;                : d                        ( delete line-1, but hold in pad *)        dup  h  0f  dup  rot                                            do  i  1+  line  i  -move  loop  e  ;                                                                                                                                                     -->                                                             (  line editting commands                        WFR-79may03 )                                                                  : m    ( move cursor by signed amount-1, print its line *)           r#  +!  cr  space  #lead  type  5f  emit                                           #lag   type  #locate  .  drop  ;                                                                        : t    ( type line by #-1,  save also in pad *)                      dup  c/l  *  r#  !  dup  h  0  m  ;                                                                                        : l     ( re-list screen *)                                             scr  @  list  0  m  ;                                   -->                                                                                                                                                                                                                                                                                                                             (  line editting commands                         WFR-790105 )  : r                         ( replace on line #-1, from pad *)        pad  1+  swap  -move  ;                                                                                                   : p                          ( put following text on line-1 *)        1  text  r  ;                                                                                                             : i                      ( insert text from pad onto line # *)        dup  s  r  ;                                                                         cr                                   : top                   ( home cursor to top left of screen *)        0  r#  !  ;                                               -->                                                                                                                                                                                                                                                             (  screen editing commands                       WFR-79apr27 )  : clear                          ( clear screen by number-1 *)        scr  !  10  0  do  forth  i  editor  e  loop  ;                                                                           : flush                  ( write all updated blocks to disc *)      [  limit  first  -  b/buf  4  +  /  ] ( number of buffers)      literal  0  do  7fff  buffer  drop  loop  ;                                                                                 : copy                  ( duplicate screen-2, onto screen-1 *)     b/scr  *  offset  @  +  swap  b/scr  *  b/scr  over  + swap     do  dup  forth  i  block  2  -  !  1+   update  loop            drop  flush  ;                                               -->                                                                                                                                                                                                                                                             (  double number support                         WFR-80apr24 )  (  operates on 32 bit double numbers  or two 16-bit integers )  forth definitions                                                                                                               : 2drop   drop    drop  ;  ( drop double number )                                                                               : 2dup    over    over  ;  ( duplicate a double number )                                                                        : 2swap   rot     >r    rot   r>  ;                                     ( bring second double to top of stack )                 editor definitions  -->                                                                                                                                                                                                                                                                                                                                                                         (  string match for editor                    PM-WFR-80apr25 )  : -text                  ( address-3, count-2, address-1 --- )   swap   -dup  if ( leave boolean matched=non-zero, nope=zero )                over + swap     ( neither address may be zero! )          do  dup  c@  forth  i  c@  -                                        if  0=  leave  else  1+  then    loop                       else  drop  0=  then  ;                                 : match  ( cursor address-4, bytes left-3, string address-2, )           ( string count-1, ---  boolean-2, cursor movement-1 )    >r  >r  2dup  r>  r>  2swap  over  +  swap                      ( caddr-6, bleft-5, $addr-4, $len-3, caddr+bleft-2, caddr-1)    do  2dup  forth  i   -text                                        if  >r  2drop  r>  -  i  swap  -  0  swap  0  0  leave              (  caddr bleft  $addr  $len or else 0  offset  0  0 )         then  loop 2drop   ( caddr-2, bleft-1, or 0-2, offset-1)      swap  0=  swap  ;    -->                                    (  string editing commands                       WFR-79mar24 )  : 1line      ( scan line with cursor for match to pad text, *)                              ( update cursor, return boolean *)         #lag  pad  count  match  r#   +!  ;                                                                                      :  find  ( string at pad over full screen range, else error *)       begin  3ff  r#  @  <                                                if  top  pad  here  c/l  1+  cmove  0  error  endif             1line   until   ;                                                                                                      : delete                   ( backwards at cursor by count-1 *)      >r  #lag  +  forth  r  -  ( save blank fill location )          #lag  r minus  r#  +!     ( backup cursor )                     #lead  +  swap  cmove                                           r>  blanks  update  ;   ( fill from end of text )           -->                                                             (  string editor commands                        WFR-79mar24 )  : n     ( find next occurance of previous text *)                     find  0  m  ;                                                                                                             : f      ( find occurance of following text *)                        1  text  n  ;                                                                                                             : b     ( backup cursor by text in pad *)                             pad  c@  minus  m  ;                                                                                                      : x     ( delete following text *)                                    1  text  find  pad  c@  delete  0  m  ;                                                                                   : till   ( delete on cursor line, from cursor to text end *)          #lead  +  1  text  1line  0=  0  ?error                         #lead  +  swap  -  delete  0  m  ;     -->                (  string editor commands                        WFR-79mar23 )  : c       ( spread at cursor and copy in the following text *)      1  text  pad  count                                             #lag  rot  over  min  >r                                        forth  r  r#  +!  ( bump cursor )                               r  -  >r          ( chars to save )                             dup  here  r  cmove  ( from old cursor to here )                here  #lead  +  r>  cmove  ( here to cursor location )          r>  cmove  update   ( pad to old cursor )                       0  m  ( look at new line )  ;                               forth  definitions   decimal                                    latest   12  +origin  !   ( top nfa )                           here     28  +origin  !   ( fence )                             here     30  +origin  !   ( dp )                                '  editor  6  +   32  +origin  !  ( voc-link )                  here  fence   !      ;s                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         